<div class="statistics" [ngClass]="{'dark-mode': isDarkMode}">
    <!-- WebGL Background Canvas -->
    <canvas id="bgCanvas" class="webgl-bg"></canvas>

    <!-- Sidebar -->
    <aside class="sidebar" [class.open]="isSidebarOpen" aria-label="Admin Navigation">
        <button class="sidebar-toggle" (click)="toggleSidebar($event)" aria-label="Toggle Navigation">
            <span *ngIf="!isSidebarOpen"><i class="fas fa-bars"></i></span>
            <span *ngIf="isSidebarOpen"><i class="fas fa-times"></i></span>
        </button>
        <nav class="sidebar-nav">
            <div class="sidebar-header">
                <h2 class="sidebar-title">MedTrack</h2>
                <p class="sidebar-subtitle">Admin Portal</p>
            </div>
            <a routerLink="/admin/dashboard" class="nav-link" data-aos="fade-right" data-aos-delay="100">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a routerLink="/admin/statistics" class="nav-link active" data-aos="fade-right" data-aos-delay="200">
                <i class="fas fa-chart-line"></i> Statistics
            </a>
            <a routerLink="/admin/user-management" class="nav-link" data-aos="fade-right" data-aos-delay="300">
                <i class="fas fa-users-cog"></i> User Management
            </a>
            <a routerLink="/admin/feedback-management" class="nav-link" data-aos="fade-right" data-aos-delay="400">
                <i class="fas fa-comments"></i> Feedback Management
            </a>
            <a routerLink="/admin/content-management" class="nav-link" data-aos="fade-right" data-aos-delay="500">
                <i class="fas fa-file-alt"></i> Content Management
            </a>
            <a routerLink="/admin/settings" class="nav-link" data-aos="fade-right" data-aos-delay="600">
                <i class="fas fa-cogs"></i> Settings
            </a>
            <button class="nav-link logout-button" (click)="logout()" data-aos="fade-right" data-aos-delay="700">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </nav>
        <button class="dark-mode-toggle" (click)="toggleDarkMode()" aria-label="Toggle Dark Mode">
            <span *ngIf="!isDarkMode"><i class="fas fa-moon"></i></span>
            <span *ngIf="isDarkMode"><i class="fas fa-sun"></i></span>
        </button>
    </aside>

    <!-- Main Content -->
    <main class="main-content" (click)="closeSidebarOnClickOutside($event)" aria-label="Main Statistics Content">
        <!-- Notification Bubble -->
        <div class="notification-bubble" (click)="toggleNotifications($event)" data-aos="zoom-in">
            <i class="fas fa-bell notification-icon"></i>
            <span class="badge" *ngIf="pendingActions.length > 0">{{ pendingActions.length }}</span>
        </div>
        <div class="notification-dropdown" *ngIf="isNotificationsOpen" data-aos="fade-down">
            <div class="dropdown-header">
                <h3>Pending Actions</h3>
                <button class="close-btn" (click)="toggleNotifications($event)">âœ•</button>
            </div>
            <div class="notification-list">
                <div *ngFor="let action of pendingActions" class="notification-item" data-tilt data-aos="fade-up">
                    <p class="notification-message">{{ action.message }}</p>
                    <p class="notification-time">{{ action.createdAt | date: 'short' }}</p>
                </div>
                <div *ngIf="pendingActions.length === 0" class="no-data">
                    No pending actions.
                </div>
            </div>
            <a routerLink="/admin/pending-actions" class="view-all-link">View All Pending Actions</a>
        </div>

        <!-- Header -->
        <header class="dashboard-header" data-aos="zoom-in">
            <h1 class="title">System Statistics</h1>
            <p class="subtitle">Detailed Analytics for MedTrack Operations</p>
        </header>

        <!-- Date Range Filter -->
        <section class="filter-section" data-aos="fade-up">
            <h2 class="section-title">Filter Statistics</h2>
            <div class="filter-controls">
                <label for="startDate">Start Date:</label>
                <input type="date" id="startDate" [(ngModel)]="startDate" (change)="loadAdminStatistics()">
                <label for="endDate">End Date:</label>
                <input type="date" id="endDate" [(ngModel)]="endDate" (change)="loadAdminStatistics()">
            </div>
        </section>

        <!-- Statistics Section with Google Charts -->
        <section class="dashboard-section stats-section" data-aos="fade-up">
            <h2 class="section-title">Statistics Overview</h2>
            <div class="stats-grid">
                <!-- User Registrations Over Time (Line Chart) -->
                <div class="dashboard-card" data-tilt data-aos="flip-up">
                    <h3 class="card-title">User Registrations Over Time</h3>
                    <div id="userRegistrationsChart" class="chart-container"></div>
                </div>

                <!-- Appointment Distribution by Status (Pie Chart) -->
                <div class="dashboard-card" data-tilt data-aos="flip-up">
                    <h3 class="card-title">Appointment Distribution by Status</h3>
                    <div id="appointmentStatusChart" class="chart-container"></div>
                </div>

                <!-- Appointments by Doctor (Bar Chart) -->
                <div class="dashboard-card" data-tilt data-aos="flip-up">
                    <h3 class="card-title">Appointments by Doctor</h3>
                    <div id="appointmentsByDoctorChart" class="chart-container"></div>
                </div>

                <!-- Average Blood Pressure Over Time (Line Chart) -->
                <div class="dashboard-card" data-tilt data-aos="flip-up">
                    <h3 class="card-title">Average Blood Pressure Over Time</h3>
                    <div id="bloodPressureChart" class="chart-container"></div>
                </div>

                <!-- Engagement Scores (Bar Chart) -->
                <div class="dashboard-card" data-tilt data-aos="flip-up">
                    <h3 class="card-title">Patient Engagement Scores</h3>
                    <div id="engagementScoresChart" class="chart-container"></div>
                </div>

                <!-- Peak Usage Times (Column Chart) -->
                <div class="dashboard-card" data-tilt data-aos="flip-up">
                    <h3 class="card-title">Peak Appointment Hours</h3>
                    <div id="peakUsageChart" class="chart-container"></div>
                </div>
            </div>
        </section>
    </main>
</div>